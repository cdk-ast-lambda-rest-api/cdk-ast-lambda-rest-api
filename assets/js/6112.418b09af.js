"use strict";(self.webpackChunkcalra_docs=self.webpackChunkcalra_docs||[]).push([[6112,2312,3513],{7561:(e,t,a)=>{a.d(t,{v:()=>s,e:()=>c});const o=Symbol("orama.insertions"),n=Symbol("orama.removals");var i;const r=(null===(i=globalThis.process)||void 0===i?void 0:i.emitWarning)??function(e,t){console.warn(`[WARNING] [${t.code}] ${e}`)};function s(e){"number"!=typeof e[o]&&(queueMicrotask((()=>{e[o]=void 0})),e[o]=0),e[o]>1e3?(r("Orama's insert operation is synchronous. Please avoid inserting a large number of document in a single operation in order not to block the main thread or, in alternative, please use insertMultiple.",{code:"ORAMA0001"}),e[o]=-1):e[o]>=0&&e[o]++}function c(e){"number"!=typeof e[n]&&(queueMicrotask((()=>{e[n]=void 0})),e[n]=0),e[n]>1e3?(r("Orama's remove operation is synchronous. Please avoid removing a large number of document in a single operation in order not to block the main thread, in alternative, please use updateMultiple.",{code:"ORAMA0002"}),e[n]=-1):e[n]>=0&&e[n]++}},2312:(e,t,a)=>{a.r(t),a.d(t,{innerInsertMultiple:()=>d,insert:()=>s,insertMultiple:()=>u});var o=a(3283),n=a(5341),i=a(7561),r=a(7025);async function s(e,t,a,s){const u=await e.validateSchema(t,e.schema);if(u)throw(0,r.$)("SCHEMA_VALIDATION_FAILURE",u);return async function(e,t,a,s){const{index:u,docs:d}=e.data,f=await e.getDocumentIndexId(t);if("string"!=typeof f)throw(0,r.$)("DOCUMENT_ID_MUST_BE_STRING",typeof f);if(!await e.documentsStore.store(d,f,t))throw(0,r.$)("DOCUMENT_ALREADY_EXISTS",f);const m=await e.documentsStore.count(d);s||await(0,n.VK)(e.beforeInsert,e,f,t);const w=await e.index.getSearchableProperties(u),p=await e.index.getSearchablePropertiesWithTypes(u),v=await e.getDocumentProperties(t,w);for(const[n,i]of Object.entries(v)){if(void 0===i)continue;const e=typeof i,t=p[n];if((!(0,o.isGeoPointType)(t)||"object"!=typeof i||"number"!=typeof i.lon||"number"!=typeof i.lat)&&!((0,o.isVectorType)(t)&&Array.isArray(i)||(0,o.isArrayType)(t)&&Array.isArray(i)||c.has(t)&&l.has(e)||e===t))throw(0,r.$)("INVALID_DOCUMENT_PROPERTY",n,t,e)}for(const o of w){var h,y,b,g;const t=v[o];if(void 0===t)continue;const n=p[o];await(null===(y=(h=e.index).beforeInsert)||void 0===y?void 0:y.call(h,e.data.index,o,f,t,n,a,e.tokenizer,m)),await e.index.insert(e.index,e.data.index,o,f,t,n,a,e.tokenizer,m),await(null===(g=(b=e.index).afterInsert)||void 0===g?void 0:g.call(b,e.data.index,o,f,t,n,a,e.tokenizer,m))}const S=await e.sorter.getSortableProperties(e.data.sorting),I=await e.sorter.getSortablePropertiesWithTypes(e.data.sorting),A=await e.getDocumentProperties(t,S);for(const o of S){const t=A[o];if(void 0===t)continue;const n=I[o];await e.sorter.insert(e.data.sorting,o,f,t,n,a)}s||await(0,n.VK)(e.afterInsert,e,f,t);return(0,i.v)(e),f}(e,t,a,s)}const c=new Set(["enum","enum[]"]),l=new Set(["string","number"]);async function u(e,t,a,o,i,s){i||await(0,n.F_)(e.beforeInsertMultiple,e,t);const c=t.length,l=e.schema;for(let n=0;n<c;n++){const a=await e.validateSchema(t[n],l);if(a)throw(0,r.$)("SCHEMA_VALIDATION_FAILURE",a)}return d(e,t,a,o,i,s)}async function d(e,t,a,o,i,r){a||(a=1e3),r??=0;const c=[];return await new Promise(((n,l)=>{let u=0;setTimeout((async function d(){const f=t.slice(u*a,++u*a);if(!f.length)return n();for(const t of f)try{const a=await s(e,t,o,i);c.push(a)}catch(m){l(m)}setTimeout(d,r)}),r)})),i||await(0,n.F_)(e.afterInsertMultiple,e,t),c}},3513:(e,t,a)=>{a.r(t),a.d(t,{remove:()=>r,removeMultiple:()=>s});var o=a(5341),n=a(7348),i=a(7561);async function r(e,t,a,r){let s=!0;const{index:c,docs:l}=e.data,u=await e.documentsStore.get(l,t);if(!u)return!1;const d=(0,n.f8)(e.internalDocumentIDStore,(0,n.Kj)(e.internalDocumentIDStore,t)),f=await e.documentsStore.count(l);r||await(0,o.VK)(e.beforeRemove,e,d);const m=await e.index.getSearchableProperties(c),w=await e.index.getSearchablePropertiesWithTypes(c),p=await e.getDocumentProperties(u,m);for(const o of m){var v,h,y,b;const n=p[o];if(void 0===n)continue;const i=w[o];await(null===(h=(v=e.index).beforeRemove)||void 0===h?void 0:h.call(v,e.data.index,o,d,n,i,a,e.tokenizer,f)),await e.index.remove(e.index,e.data.index,o,t,n,i,a,e.tokenizer,f)||(s=!1),await(null===(b=(y=e.index).afterRemove)||void 0===b?void 0:b.call(y,e.data.index,o,d,n,i,a,e.tokenizer,f))}const g=await e.sorter.getSortableProperties(e.data.sorting),S=await e.getDocumentProperties(u,g);for(const o of g)void 0!==S[o]&&await e.sorter.remove(e.data.sorting,o,t);return r||await(0,o.VK)(e.afterRemove,e,d),await e.documentsStore.remove(e.data.docs,t),(0,i.e)(e),s}async function s(e,t,a,i,s){let c=0;a||(a=1e3);const l=s?[]:t.map((t=>(0,n.f8)(e.internalDocumentIDStore,(0,n.Kj)(e.internalDocumentIDStore,t))));return s||await(0,o.F_)(e.beforeRemoveMultiple,e,l),await new Promise(((o,n)=>{let l=0;setTimeout((async function u(){const d=t.slice(l*a,++l*a);if(!d.length)return o();for(const t of d)try{await r(e,t,i,s)&&c++}catch(f){n(f)}setTimeout(u,0)}),0)})),s||await(0,o.F_)(e.afterRemoveMultiple,e,l),c}},6112:(e,t,a)=>{a.r(t),a.d(t,{update:()=>s,updateMultiple:()=>c});var o=a(5341),n=a(7025),i=a(2312),r=a(3513);async function s(e,t,a,n,s){!s&&e.beforeUpdate&&await(0,o.VK)(e.beforeUpdate,e,t),await(0,r.remove)(e,t,n,s);const c=await(0,i.insert)(e,a,n,s);return!s&&e.afterUpdate&&await(0,o.VK)(e.afterUpdate,e,c),c}async function c(e,t,a,s,c,l){l||await(0,o.F_)(e.beforeUpdateMultiple,e,t);const u=a.length;for(let o=0;o<u;o++){const t=await e.validateSchema(a[o],e.schema);if(t)throw(0,n.$)("SCHEMA_VALIDATION_FAILURE",t)}await(0,r.removeMultiple)(e,t,s,c,l);const d=await(0,i.innerInsertMultiple)(e,a,s,c,l);return l||await(0,o.F_)(e.afterUpdateMultiple,e,d),d}}}]);